{% extends "base.html" %}

{% block title %}Travel Mind - Twój Inteligentny Asystent Podróży{% endblock %}

{% block content %}
    <div class="hero-section">
        <div class="container">
            <h1><span class="icon">✈️</span> Travel Mind</h1>
            <p>Wpisz swój cel podróży, a my wygenerujemy spersonalizowany plan, pogodę i szacowany budżet.</p>
            
            <form method="POST" action="">
                {{ form.hidden_tag() }}
                
                <div class="form-group">
                    {{ form.city.label }}
                    {{ form.city(class="form-control", placeholder="np. Kraków, Rzym lub Tatry") }}
                </div>
                <div class="form-group">
                    {{ form.start_date.label }}
                    {{ form.start_date(class="form-control", type="date", id="start_date") }}
                </div>
                <div class="form-group">
                    {{ form.end_date.label }}
                    {{ form.end_date(class="form-control", type="date", id="end_date") }}
                </div>
                <div class="form-group">
                    <small id="days-info" class="form-text text-muted"></small>
                    <div id="date-error" class="text-danger" role="alert" aria-live="polite"></div>
                </div>
                <div class="form-group">
                    {{ form.travel_style.label }}
                    {{ form.travel_style(class="form-control") }}
                </div>
                
                {{ form.submit(class="btn btn-primary", id="submit-btn") }}
            </form>
        </div>
    </div>
    <script>
        (function() {
            const start = document.getElementById('start_date');
            const end = document.getElementById('end_date');
            const info = document.getElementById('days-info');
            const error = document.getElementById('date-error');
            const submit = document.getElementById('submit-btn');

            function updateInfo() {
                if (!start || !end || !info || !error || !submit) return;
                const sVal = start.value;
                const eVal = end.value;
                if (sVal && eVal) {
                    const s = new Date(sVal);
                    const e = new Date(eVal);
                    const diffMs = e - s;
                    const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                    const days = diffDays >= 0 ? diffDays + 1 : 0;
                    if (days <= 0) {
                        info.textContent = '';
                        error.textContent = 'Data powrotu musi być po dacie wyjazdu.';
                        submit.disabled = true;
                    } else if (days > 16) {
                        info.textContent = `Wybrano ${days} dni`;
                        error.textContent = 'Maksymalny dozwolony przedział to 16 dni.';
                        submit.disabled = true;
                    } else {
                        info.textContent = `Wybrano ${days} dni`;
                        error.textContent = '';
                        submit.disabled = false;
                    }
                    // set minimum for end date to help user
                    end.min = sVal;
                } else {
                    info.textContent = '';
                    error.textContent = '';
                    submit.disabled = false;
                    // reset min
                    end.min = '';
                }
            }

            start && start.addEventListener('change', updateInfo);
            end && end.addEventListener('change', updateInfo);
            // init on load
            document.addEventListener('DOMContentLoaded', updateInfo);
        })();
    </script>
{% endblock %}