{% extends "base.html" %}

{% block title %}Tw√≥j plan dla: {{ plan.query.city }}{% endblock %}

{% block content %}
<div class="container plan-results">
    
    <header class="plan-header">
        <h1>Plan podr√≥≈ºy: {{ plan.query.city }}</h1>
        <p class="subtitle">
            <span class="badge days-badge">{{ plan.query.days }} dni</span>
            <span class="badge style-badge">{{ plan.query.style }}</span>
        </p>
    </header>

    <!-- Pogoda - g√≥rna sekcja -->
    <div class="card weather-card weather-top">
        <h2><span class="icon">‚òÄÔ∏è</span> Pogoda</h2>
        <div class="weather-details">
                {% if plan.weather.daily is defined %}
                <div class="daily-weather-list">
                    {% for day in plan.weather.daily %}
                    <div class="daily-item card">
                        <h3>{{ day.date_label or day.date }}</h3>
                        <p><strong>
                            <!-- Zastƒôpujemy ≈Çadowanie SVG prostƒÖ emoji/ikonkƒÖ wklejonƒÖ inline -->
                            <span class="weather-emoji">{{ day.icon_emoji or day.icon or 'üå§Ô∏è' }}</span>
                            <span class="weather-icon-key {% if day.icon_key %}weather-{{ day.icon_key }}{% endif %}" data-weather="{{ day.weathercode or '' }}">{{ day.opis or 'Brak danych' }}</span>
                        </strong></p>
                        <p>Min / Max: <strong>{% if day.temperatura_min is defined %}{{ day.temperatura_min }}¬∞C{% else %}-{% endif %}</strong> / <strong>{% if day.temperatura_max is defined %}{{ day.temperatura_max }}¬∞C{% else %}-{% endif %}</strong></p>
                        {% if day.opad_mm is defined %}
                        <p>Opad: <strong>{{ day.opad_mm }} mm</strong></p>
                        {% endif %}
                        {% if day.wiatr_kmh is defined %}
                        <p>Wiatr: <strong>{{ day.wiatr_kmh }} km/h</strong></p>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p>≈örednia temperatura: <strong>{{ plan.weather.temperatura }}¬∞C</strong></p>
                {% if plan.weather.temperatura_min is defined and plan.weather.temperatura_max is defined %}
                <p>Min / Max: <strong>{{ plan.weather.temperatura_min }}¬∞C</strong> / <strong>{{ plan.weather.temperatura_max }}¬∞C</strong></p>
                {% endif %}
                {% if plan.weather.wilgotnosc is defined %}
                <p>Wilgotno≈õƒá: <strong>{{ plan.weather.wilgotnosc }}%</strong></p>
                {% endif %}
                <p>Warunki: {{ plan.weather.opis }}</p>
                {% if plan.weather.wiatr_kmh is defined %}
                <p>Prƒôdko≈õƒá wiatru: {{ plan.weather.wiatr_kmh }} km/h</p>
                {% endif %}
                {% endif %}
        </div>
    </div>

    <div class="info-grid">
        
        <div class="card budget-card">
            <h2><span class="icon">üí∞</span> Szacowany bud≈ºet</h2>
            {% if plan.cost.total_pln is not none %}
                <p class="main-cost">Ca≈Çkowity koszt: <strong>{{ plan.cost.total_pln }} PLN</strong></p>
                <p>Koszt w walucie lokalnej: {{ plan.cost.total_local }} {{ plan.cost.currency }}</p>
            {% else %}
                <p class="info-note">Dla tego miasta nie mamy jeszcze danych o szacunkowych kosztach.</p>
            {% endif %}
        </div>
        
        <!-- 'Wa≈ºne obiekty' section removed as requested -->
        <div class="card nearby-card">
            <h2><span class="icon">üìç</span> Miejsca w pobli≈ºu (30 km)</h2>
            {% if plan.nearby_places and plan.nearby_places|length > 0 %}
            <ul class="nearby-list">
                {% for place in plan.nearby_places %}
                <li class="nearby-item">
                    <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;">
                        <strong class="nearby-name">{{ place.name }}</strong>
                        {% if place.dist_km %}<span class="muted">{{ place.dist_km }} km</span>{% endif %}
                    </div>
                    {% if place.category %}
                    <div class="nearby-cat muted">{{ place.category }}</div>
                    {% endif %}
                    {% if place.address %}<div class="nearby-address">{{ place.address }}</div>{% endif %}
                    {% if place.lat is defined and place.lon is defined and place.lat and place.lon %}
                    <div style="margin-top:6px;">
                        <a class="map-link" href="https://www.openstreetmap.org/?mlat={{ place.lat }}&mlon={{ place.lon }}#map=14/{{ place.lat }}/{{ place.lon }}" target="_blank" rel="noopener">Poka≈º na mapie</a>
                    </div>
                    {% endif %}
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <p class="info-note">Brak danych o miejscach w pobli≈ºu lub brak klucza Geoapify.</p>
            {% endif %}
        </div>
    </div>
    
    <div class="attractions-section">
        <h2><span class="icon">üèõÔ∏è</span> G≈Ç√≥wne atrakcje</h2>
        
        <!-- Karty atrakcji renderowane po stronie serwera -->
        <div class="attraction-cards" id="attractions-container">
            {% if plan.attractions and plan.attractions|length > 0 %}
                {% for attraction in plan.attractions %}
                <div class="attraction-card card">
                    <div class="card-header">
                        {% if attraction.icon %}
                        <img src="{{ attraction.icon }}" alt="Ikona dla {{ attraction.name }}" class="attraction-icon">
                        {% endif %}
                        <h3 class="attraction-name">{{ attraction.name }}</h3>
                    </div>
                    <div class="card-body">
                        {% if attraction.address %}
                        <p class="attraction-address">{{ attraction.address }}</p>
                        {% endif %}
                        <div class="attraction-meta">
                            {% if attraction.rating %}<span class="badge rating-badge">‚≠ê {{ attraction.rating }}</span>{% endif %}
                            {% if attraction.price_level %}<span class="badge price-badge">{{ '$' * attraction.price_level }}</span>{% endif %}
                        </div>
                        {% if attraction.types and attraction.types|length > 0 %}
                        <div class="attraction-types">
                            {% for t in attraction.types[:4] %}
                            <span class="badge type-badge">{{ t.replace('_',' ')|title }}</span>
                            {% endfor %}
                        </div>
                        {% endif %}
                        {% if attraction.lat is defined and attraction.lon is defined and attraction.lat and attraction.lon %}
                        <div style="margin-top:6px;">
                            <a class="map-link" href="https://www.openstreetmap.org/?mlat={{ attraction.lat }}&mlon={{ attraction.lon }}#map=14/{{ attraction.lat }}/{{ attraction.lon }}" target="_blank" rel="noopener">Poka≈º na mapie</a>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <p>Brak danych o atrakcjach dla tego miasta.</p>
            {% endif %}
        </div>
        <!-- Map view removed: attractions shown server-side -->
    </div>

    <div class="action-buttons">
        <button class="btn btn-secondary"><span class="icon">üìÑ</span> Pobierz jako PDF</button>
    </div>
</div>
{% endblock %}

{% block scripts %}{% endblock %}